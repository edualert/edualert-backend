{
    "family": "${APP}-migrate",
    "requiresCompatibilities": [
        "EC2"
    ],
    "networkMode":  "host",
    "executionRoleArn": "arn:aws:iam::${ACCOUNT_ID}:role/${APP}_task_role",
    "containerDefinitions": [
        {
            "name": "app",
            "image": "${IMAGE_NAME}",
            "repositoryCredentials": {
                "credentialsParameter": "${DOCKER_CREDENTIALS}"
            },
            "entryPoint": ["python", "manage.py", "migrate"],
            "essential": true,
            "stopTimeout": 20,
            "privileged": true,
            "user": "docker_user",
            "cpu": 10,
            "memory": 100,
            "memoryReservation": 100,
            "secrets": [
                {
                    "name": "DJANGO_SETTINGS_MODULE",
                    "valueFrom": "${SECRETS}:DJANGO_SETTINGS_MODULE::"
                },
                {
                    "name": "DJANGO_SECRET_KEY",
                    "valueFrom": "${SECRETS}:DJANGO_SECRET_KEY::"
                },
                {
                    "name": "CACHE_URL",
                    "valueFrom": "${SECRETS}:CACHE_URL::"
                },
                {
                    "name": "DATABASE_URL",
                    "valueFrom": "${SECRETS}:DATABASE_URL::"
                }
            ],
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                  "awslogs-region": "eu-central-1",
                  "awslogs-group": "${APP}-${ENVIRONMENT}",
                  "awslogs-stream-prefix": "${TASK_DEFINITION}-${TAG}",
                  "awslogs-create-group": "true"
                }
              }
        }
    ]
}
